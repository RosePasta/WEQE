springframework roo file monitor polling file ioexception exception util arraylist array list util hashmap hash map util hashset hash set util linkedhashset linked hash set util list util map util set util sortedset sorted set util treeset tree set util weakhashmap weak hash map springframework roo file monitor directorymonitoringrequest directory monitoring request springframework roo file monitor filemonitorservice file monitor service springframework roo file monitor monitoringrequest monitoring request springframework roo file monitor notifiablefilemonitorservice notifiable file monitor service springframework roo file monitor event filedetails file details springframework roo file monitor event fileevent file event springframework roo file monitor event fileeventlistener file event listener springframework roo file monitor event fileoperation file operation springframework roo support util simple polling based link filemonitorservice file monitor service implementation iterates link monitoringrequest monitoring request instances building active file time execution compares active file time executed link monitoringrequest monitoring request events fired event firing process completed link monitoringrequest monitoring request examined implementation recognize link fileoperation file operation renamed events implementation ignore monitored files filename starting period hidden files link fileoperation file operation deleted events implementation link fileevent file event times equal time deleted file modified time represent deletion time time deletion detected author ben alex pollingfilemonitorservice polling file monitor service notifiablefilemonitorservice notifiable file monitor service set fileeventlistener file event listener fileeventlisteners file event listeners hashset hash set fileeventlistener file event listener set monitoringrequest monitoring request requests linkedhashset linked hash set monitoringrequest monitoring request map monitoringrequest monitoring request map file priorexecution prior execution weakhashmap weak hash map monitoringrequest monitoring request map file set notifychanged notify changed hashset hash set set notifycreated notify created hashset hash set set notifydeleted notify deleted hashset hash set mutex lock add fileeventlistener file event listener lock fileeventlisteners file event listeners add remove fileeventlistener file event listener lock fileeventlisteners file event listeners remove list filedetails file details getmonitored monitored lock list filedetails file details monitored arraylist array list filedetails file details requests size monitored monitoringrequest monitoring request request requests priorexecution prior execution containskey key request map file priorfiles prior files priorexecution prior execution request file priorfile prior file priorfiles prior files keyset key set monitored add filedetails file details priorfile prior file priorfiles prior files priorfile prior file monitored isdirty dirty lock notifychanged notify changed size notifycreated notify created size notifydeleted notify deleted size iswithin monitoringrequest monitoring request request filepath file path requestcanonicalpath request canonical path requestcanonicalpath request canonical path request getfile file getcanonicalpath canonical path ioexception exception request directorymonitoringrequest directory monitoring request directorymonitoringrequest directory monitoring request dmr directorymonitoringrequest directory monitoring request request dmr iswatchsubtree watch subtree filepath file path startswith starts requestcanonicalpath request canonical path directory directory filedetails file details matchesantpath matches ant path requestcanonicalpath request canonical path file separator filepath file path directory requestcanonicalpath request canonical path equals filepath file path file scannotified scan notified lock requests size isdirty dirty notify monitoringrequest monitoring request request requests list fileevent file event eventstopublish events publish arraylist array list fileevent file event priorexecution prior execution containskey key request perform comparison data previous execution map file priorfiles prior files priorexecution prior execution request handle files updated execution set toremove remove hashset hash set filepath file path notifychanged notify changed skip notification doesn fall monitoring request iswithin request filepath file path record remove processed toremove remove add filepath file path skip file doesn exist file thisfile file file filepath file path thisfile file exists record notification eventstopublish events publish add fileevent file event filedetails file details thisfile file thisfile file lastmodified modified fileoperation file operation updated update prior execution map isn notified priorfiles prior files thisfile file thisfile file lastmodified modified remove created list notifycreated notify created filepath file path notifycreated notify created remove filepath file path remove toremove remove notifychanged notify changed remove remove handle files created execution toremove remove hashset hash set filepath file path notifycreated notify created skip notification doesn fall monitoring request iswithin request filepath file path record remove processed toremove remove add filepath file path skip file doesn exist file thisfile file file filepath file path thisfile file exists record notification eventstopublish events publish add fileevent file event filedetails file details thisfile file thisfile file lastmodified modified fileoperation file operation created update prior execution map isn notified priorfiles prior files thisfile file thisfile file lastmodified modified remove toremove remove notifycreated notify created remove remove handle files deleted execution toremove remove hashset hash set filepath file path notifydeleted notify deleted skip notification doesn fall monitoring request iswithin request filepath file path record remove processed toremove remove add filepath file path skip file suddenly exists shouldn notify deleted file thisfile file file filepath file path thisfile file exists record notification eventstopublish events publish add fileevent file event filedetails file details thisfile file fileoperation file operation deleted update prior execution map isn notified priorfiles prior files remove thisfile file remove toremove remove notifydeleted notify deleted remove remove publish eventstopublish events publish eventstopublish events publish size scanall scan lock requests size monitoringrequest monitoring request request requests includesubtree include subtree request directorymonitoringrequest directory monitoring request includesubtree include subtree directorymonitoringrequest directory monitoring request request iswatchsubtree watch subtree request getfile file exists build contents monitored location map file currentexecution current execution hashmap hash map file computeentries compute entries currentexecution current execution request getfile file includesubtree include subtree list fileevent file event eventstopublish events publish arraylist array list fileevent file event priorexecution prior execution containskey key request perform comparison data previous execution map file priorfiles prior files priorexecution prior execution request locate created modified files file thisfile file currentexecution current execution keyset key set priorfiles prior files containskey key thisfile file file exist execution eventstopublish events publish add fileevent file event filedetails file details thisfile file currentexecution current execution thisfile file fileoperation file operation created file notified notifycreated notify created remove thisfile file getcanonicalpath canonical path ioexception exception currenttimestamp current timestamp currentexecution current execution thisfile file previoustimestamp previous timestamp priorfiles prior files thisfile file currenttimestamp current timestamp equals previoustimestamp previous timestamp modified eventstopublish events publish add fileevent file event filedetails file details thisfile file currentexecution current execution thisfile file fileoperation file operation updated file notified notifychanged notify changed remove thisfile file getcanonicalpath canonical path ioexception exception locate deleted files priorfiles prior files keyset key set removeall remove currentexecution current execution keyset key set file deletedfile deleted file priorfiles prior files keyset key set eventstopublish events publish add fileevent file event filedetails file details deletedfile deleted file priorfiles prior files deletedfile deleted file fileoperation file operation deleted file notified notifydeleted notify deleted remove deletedfile deleted file getcanonicalpath canonical path ioexception exception data previous execution newly monitored location file thisfile file currentexecution current execution keyset key set eventstopublish events publish add fileevent file event filedetails file details thisfile file currentexecution current execution thisfile file fileoperation file operation monitoring start record monitored location location contents ready execution priorexecution prior execution request currentexecution current execution discard created deleted notifications correctly discovered loop notifycreated notify created clear notifydeleted notify deleted clear explicitly handle undiscovered update notifications identical millisecond update occurred canonicalpath canonical path notifychanged notify changed file file file canonicalpath canonical path eventstopublish events publish add fileevent file event filedetails file details file file lastmodified modified fileoperation file operation updated notifychanged notify changed clear publish eventstopublish events publish eventstopublish events publish size publish events needed assumes caller acquired synchronisation lock eventstopublish events publish publish empty publish list fileevent file event eventstopublish events publish eventstopublish events publish size fileeventlisteners file event listeners size eventstopublish events publish size fileevent file event event eventstopublish events publish fileeventlistener file event listener fileeventlisteners file event listeners onfileevent file event event adds entries map key map file object link file lastmodified modified time invoked file file file invoked file directory files directories invoked file directory subdirectories includesubtree include subtree computeentries compute entries map file map file currentfile current file includesubtree include subtree notnull map map required notnull currentfile current file current file required currentfile current file exists currentfile current file getname length currentfile current file getname startswith starts map currentfile current file currentfile current file lastmodified modified currentfile current file isdirectory directory file files currentfile current file listfiles list files files files length file file files file isfile file includesubtree include subtree computeentries compute entries map file includesubtree include subtree add monitoringrequest monitoring request request lock notnull request monitoringrequest monitoring request required ensure existing monitoring requests don overlap request amend existing requests ignore request request directorymonitoringrequest directory monitoring request directorymonitoringrequest directory monitoring request dmr directorymonitoringrequest directory monitoring request request dmr iswatchsubtree watch subtree monitoringrequest monitoring request existing requests existing directorymonitoringrequest directory monitoring request directorymonitoringrequest directory monitoring request existingdmr existing dmr directorymonitoringrequest directory monitoring request existing existingdmr existing dmr iswatchsubtree watch subtree request existing request directories monitor trees existingdmrpath existing dmr path newdmrpath dmr path existingdmrpath existing dmr path existingdmr existing dmr getfile file getcanonicalpath canonical path newdmrpath dmr path dmr getfile file getcanonicalpath canonical path ioexception exception ioe illegalstateexception illegal exception unable resolve canonical ioe request directory existing request ignore request unnecessary newdmrpath dmr path startswith starts existingdmrpath existing dmr path existing request directory request remove existing request request incorporate existingdmrpath existing dmr path startswith starts newdmrpath dmr path remove existing requests add request remove monitoringrequest monitoring request request lock notnull request monitoringrequest monitoring request required advise cessation monitoring priorexecution prior execution containskey key request list fileevent file event eventstopublish events publish arraylist array list fileevent file event map file priorfiles prior files priorexecution prior execution request file thisfile file priorfiles prior files keyset key set eventstopublish events publish add fileevent file event filedetails file details thisfile file priorfiles prior files thisfile file fileoperation file operation monitoring finish publish eventstopublish events publish priorexecution prior execution remove request requests remove request sortedset sorted set filedetails file details findmatchingantpath find matching ant path antpath ant path hastext text antpath ant path ant path required sortedset sorted set filedetails file details result treeset tree set filedetails file details compute starting directory reference ant path antpath ant path indexof conditionals based ensure detected character character istrue antpath ant path ant path fails include character newpath path antpath ant path substring newpath path lastindexof file separatorchar separator istrue antpath ant path fails include file separatorchar separator directory separator newpath path newpath path substring file somepath path file newpath path somepath path exists path start ant expression doesn exist there find search result istrue somepath path isdirectory directory ant path antpath ant path appears file system path somepath path directory searched recursiveantmatch recursive ant match antpath ant path somepath path result result locates files current directory patch ant path antpath ant path match required currentdirectory current directory existing directory search required result append located files required recursiveantmatch recursive ant match antpath ant path file currentdirectory current directory sortedset sorted set filedetails file details result notnull currentdirectory current directory current directory required istrue currentdirectory current directory exists currentdirectory current directory isdirectory directory path currentdirectory current directory exist directory hastext text antpath ant path ant path required notnull result result required file listfiles list files currentdirectory current directory listfiles list files listfiles list files listfiles list files length file listfiles list files isfile file filedetails file details matchesantpath matches ant path antpath ant path getcanonicalpath canonical path result add filedetails file details lastmodified modified ioexception exception recursiveantmatch recursive ant match antpath ant path result decides store notification monitoring request interested request roo details filecanonicalpath file canonical path notification isnotificationunderknownmonitoringrequest notification monitoring request filecanonicalpath file canonical path lock monitoringrequest monitoring request request requests iswithin request filecanonicalpath file canonical path notifychanged notify changed filecanonicalpath file canonical path lock isnotificationunderknownmonitoringrequest notification monitoring request filecanonicalpath file canonical path notifychanged notify changed add filecanonicalpath file canonical path notifycreated notify created filecanonicalpath file canonical path lock isnotificationunderknownmonitoringrequest notification monitoring request filecanonicalpath file canonical path notifycreated notify created add filecanonicalpath file canonical path notifydeleted notify deleted filecanonicalpath file canonical path lock isnotificationunderknownmonitoringrequest notification monitoring request filecanonicalpath file canonical path notifydeleted notify deleted add filecanonicalpath file canonical path