springframework roo file monitor polling file ioexception exception util arraylist array list util collection util hashmap hash map util hashset hash set util iterator util linkedhashset linked hash set util list util map util map entry util set util sortedset sorted set util treeset tree set util weakhashmap weak hash map commons lang lang validate springframework roo file monitor directorymonitoringrequest directory monitoring request springframework roo file monitor filemonitorservice file monitor service springframework roo file monitor monitoringrequest monitoring request springframework roo file monitor notifiablefilemonitorservice notifiable file monitor service springframework roo file monitor event filedetails file details springframework roo file monitor event fileevent file event springframework roo file monitor event fileeventlistener file event listener springframework roo file monitor event fileoperation file operation springframework roo support util fileutils file utils simple polling based link filemonitorservice file monitor service implementation iterates link monitoringrequest monitoring request instances building active file time execution compares active file time executed link monitoringrequest monitoring request events fired event firing process completed link monitoringrequest monitoring request examined implementation recognize link fileoperation file operation renamed events implementation ignore monitored files filename starting period hidden files link fileoperation file operation deleted events implementation link fileevent file event times equal time deleted file modified time represent deletion time time deletion detected author ben alex pollingfilemonitorservice polling file monitor service notifiablefilemonitorservice notifiable file monitor service set allfiles files hashset hash set map set changemap change map hashmap hash map set set fileeventlistener file event listener fileeventlisteners file event listeners hashset hash set fileeventlistener file event listener object lock object set notifychanged notify changed hashset hash set set notifycreated notify created hashset hash set set notifydeleted notify deleted hashset hash set map monitoringrequest monitoring request map file priorexecution prior execution weakhashmap weak hash map monitoringrequest monitoring request map file set monitoringrequest monitoring request requests linkedhashset linked hash set monitoringrequest monitoring request add fileeventlistener file event listener lock fileeventlisteners file event listeners add add monitoringrequest monitoring request request lock validate notnull request monitoringrequest monitoring request required ensure existing monitoring requests don overlap request amend existing requests ignore request request directorymonitoringrequest directory monitoring request directorymonitoringrequest directory monitoring request dmr directorymonitoringrequest directory monitoring request request dmr iswatchsubtree watch subtree monitoringrequest monitoring request existing requests existing directorymonitoringrequest directory monitoring request directorymonitoringrequest directory monitoring request existingdmr existing dmr directorymonitoringrequest directory monitoring request existing existingdmr existing dmr iswatchsubtree watch subtree request existing request directories monitor trees existingdmrpath existing dmr path newdmrpath dmr path existingdmrpath existing dmr path existingdmr existing dmr getfile file getcanonicalpath canonical path newdmrpath dmr path dmr getfile file getcanonicalpath canonical path ioexception exception ioe illegalstateexception illegal exception unable resolve canonical ioe request directory existing request ignore request unnecessary newdmrpath dmr path startswith starts existingdmrpath existing dmr path existing request directory request remove existing request request incorporate existingdmrpath existing dmr path startswith starts newdmrpath dmr path remove existing requests add request adds entries map key map file object link file lastmodified modified time invoked file file file invoked file directory files directories invoked file directory subdirectories includesubtree include subtree computeentries compute entries map file map file currentfile current file includesubtree include subtree validate notnull map map required validate notnull currentfile current file current file required currentfile current file exists currentfile current file getname length currentfile current file getname startswith starts currentfile current file getname equals log roo currentfile current file isdirectory directory isexcludeddirectory excluded directory currentfile current file getpath path map currentfile current file currentfile current file lastmodified modified allfiles files add currentfile current file getcanonicalpath canonical path ioexception exception currentfile current file isdirectory directory file files currentfile current file listfiles list files files files length file file files file isfile file includesubtree include subtree computeentries compute entries map file includesubtree include subtree sortedset sorted set filedetails file details findmatchingantpath find matching ant path antpath ant path validate notblank blank antpath ant path ant path required sortedset sorted set filedetails file details result treeset tree set filedetails file details compute starting directory reference ant path antpath ant path indexof conditionals based ensure detected character character validate istrue ant path fails include character antpath ant path newpath path antpath ant path substring newpath path lastindexof file separatorchar separator validate istrue fails include directory separator antpath ant path file separatorchar separator newpath path newpath path substring file somepath path file newpath path somepath path exists path start ant expression doesn exist there find search result validate istrue somepath path isdirectory directory ant path appears file system path directory searched antpath ant path somepath path recursiveantmatch recursive ant match antpath ant path somepath path result result collection getdirtyfiles dirty files requestingclass requesting lock collection changessincelastrequest request changemap change map requestingclass requesting changessincelastrequest request changemap change map requestingclass requesting linkedhashset linked hash set linkedhashset linked hash set allfiles files collection copyofchangessincelastrequest copy request linkedhashset linked hash set changessincelastrequest request changessincelastrequest request clear copyofchangessincelastrequest copy request list fileevent file event getfilecreationevents file creation events monitoringrequest monitoring request request map file priorfiles prior files list fileevent file event createevents create events arraylist array list fileevent file event iterator iter notifycreated notify created iterator iter hasnext filepath file path iter iswithin request filepath file path iter remove processed skip file doesn exist file thisfile file file filepath file path thisfile file exists record notification createevents create events add fileevent file event filedetails file details thisfile file thisfile file lastmodified modified fileoperation file operation created update prior execution map isn notified priorfiles prior files thisfile file thisfile file lastmodified modified createevents create events list fileevent file event getfiledeletionevents file deletion events monitoringrequest monitoring request request map file priorfiles prior files list fileevent file event deleteevents delete events arraylist array list fileevent file event iterator iter notifydeleted notify deleted iterator iter hasnext filepath file path iter iswithin request filepath file path iter remove processed skip file suddenly exists shouldn notify deleted file thisfile file file filepath file path thisfile file exists record notification deleteevents delete events add fileevent file event filedetails file details thisfile file fileoperation file operation deleted update prior execution map isn notified priorfiles prior files remove thisfile file deleteevents delete events list fileevent file event getfileupdateevents file update events monitoringrequest monitoring request request map file priorfiles prior files list fileevent file event updateevents update events arraylist array list fileevent file event iterator iter notifychanged notify changed iterator iter hasnext filepath file path iter iswithin request filepath file path iter remove processed skip file doesn exist file thisfile file file filepath file path thisfile file exists record notification updateevents update events add fileevent file event filedetails file details thisfile file thisfile file lastmodified modified fileoperation file operation updated update prior execution map isn notified priorfiles prior files thisfile file thisfile file lastmodified modified remove created list notifycreated notify created filepath file path notifycreated notify created remove filepath file path updateevents update events list filedetails file details getmonitored monitored lock list filedetails file details monitored arraylist array list filedetails file details requests isempty empty monitored monitoringrequest monitoring request request requests priorexecution prior execution containskey key request map file priorfiles prior files priorexecution prior execution request entry file entry priorfiles prior files entryset entry set monitored add filedetails file details entry getkey key entry getvalue monitored isdirty dirty lock notifychanged notify changed isempty empty notifycreated notify created isempty empty notifydeleted notify deleted isempty empty isexcludeddirectory excluded directory path hassrc src path file separator src hassrc src path file separator target path file separator bin hassrc src path file separator maven decides store notification monitoring request interested request roo details filecanonicalpath file canonical path notification isnotificationunderknownmonitoringrequest notification monitoring request filecanonicalpath file canonical path lock monitoringrequest monitoring request request requests iswithin request filecanonicalpath file canonical path iswithin monitoringrequest monitoring request request filepath file path requestcanonicalpath request canonical path requestcanonicalpath request canonical path request getfile file getcanonicalpath canonical path ioexception exception request directorymonitoringrequest directory monitoring request directorymonitoringrequest directory monitoring request dmr directorymonitoringrequest directory monitoring request request dmr iswatchsubtree watch subtree filepath file path startswith starts requestcanonicalpath request canonical path directory directory fileutils file utils matchesantpath matches ant path requestcanonicalpath request canonical path file separator filepath file path directory requestcanonicalpath request canonical path equals filepath file path file norequestsorchanges requests requests isempty empty isdirty dirty notifychanged notify changed filecanonicalpath file canonical path lock updatechanges update filecanonicalpath file canonical path isnotificationunderknownmonitoringrequest notification monitoring request filecanonicalpath file canonical path notifychanged notify changed add filecanonicalpath file canonical path notifycreated notify created filecanonicalpath file canonical path lock updatechanges update filecanonicalpath file canonical path isnotificationunderknownmonitoringrequest notification monitoring request filecanonicalpath file canonical path notifycreated notify created add filecanonicalpath file canonical path notifydeleted notify deleted filecanonicalpath file canonical path lock updatechanges update filecanonicalpath file canonical path isnotificationunderknownmonitoringrequest notification monitoring request filecanonicalpath file canonical path notifydeleted notify deleted add filecanonicalpath file canonical path publish events needed assumes caller acquired synchronisation lock eventstopublish events publish publish empty publish list fileevent file event eventstopublish events publish eventstopublish events publish isempty empty fileeventlisteners file event listeners isempty empty eventstopublish events publish isempty empty fileevent file event event eventstopublish events publish updatechanges update event getfiledetails file details getcanonicalpath canonical path event getoperation operation fileoperation file operation deleted fileeventlistener file event listener fileeventlisteners file event listeners onfileevent file event event publishrequestedfileevents publish requested file events eventspublished events published monitoringrequest monitoring request request requests list fileevent file event eventstopublish events publish arraylist array list fileevent file event file checked map file priorfiles prior files priorexecution prior execution request priorfiles prior files priorfiles prior files hashmap hash map file priorexecution prior execution request priorfiles prior files handle files updated created deleted execution eventstopublish events publish addall add getfileupdateevents file update events request priorfiles prior files eventstopublish events publish addall add getfilecreationevents file creation events request priorfiles prior files eventstopublish events publish addall add getfiledeletionevents file deletion events request priorfiles prior files publish eventstopublish events publish eventspublished events published eventstopublish events publish size eventspublished events published locates files current directory patch ant path antpath ant path match required currentdirectory current directory existing directory search required result append located files required recursiveantmatch recursive ant match antpath ant path file currentdirectory current directory sortedset sorted set filedetails file details result validate notnull currentdirectory current directory current directory required validate istrue currentdirectory current directory exists currentdirectory current directory isdirectory directory path exist directory currentdirectory current directory validate notblank blank antpath ant path ant path required validate notnull result result required file listfiles list files currentdirectory current directory listfiles list files listfiles list files listfiles list files length file listfiles list files fileutils file utils matchesantpath matches ant path antpath ant path getcanonicalpath canonical path result add filedetails file details lastmodified modified ioexception exception isdirectory directory recursiveantmatch recursive ant match antpath ant path result remove fileeventlistener file event listener lock fileeventlisteners file event listeners remove remove monitoringrequest monitoring request request lock validate notnull request monitoringrequest monitoring request required advise cessation monitoring priorexecution prior execution containskey key request list fileevent file event eventstopublish events publish arraylist array list fileevent file event map file priorfiles prior files priorexecution prior execution request entry file entry priorfiles prior files entryset entry set file thisfile file entry getkey key lastmodified modified entry getvalue eventstopublish events publish add fileevent file event filedetails file details thisfile file lastmodified modified fileoperation file operation monitoring finish publish eventstopublish events publish priorexecution prior execution remove request requests remove request scanall scan lock requests isempty empty monitoringrequest monitoring request request requests includesubtree include subtree request directorymonitoringrequest directory monitoring request includesubtree include subtree directorymonitoringrequest directory monitoring request request iswatchsubtree watch subtree request getfile file exists build contents monitored location map file currentexecution current execution hashmap hash map file computeentries compute entries currentexecution current execution request getfile file includesubtree include subtree list fileevent file event eventstopublish events publish arraylist array list fileevent file event priorexecution prior execution containskey key request perform comparison data previous execution map file priorfiles prior files priorexecution prior execution request locate created modified files entry file entry currentexecution current execution entryset entry set file thisfile file entry getkey key currenttimestamp current timestamp entry getvalue priorfiles prior files containskey key thisfile file file exist execution eventstopublish events publish add fileevent file event filedetails file details thisfile file currenttimestamp current timestamp fileoperation file operation created file notified notifycreated notify created remove thisfile file getcanonicalpath canonical path ioexception exception previoustimestamp previous timestamp priorfiles prior files thisfile file currenttimestamp current timestamp equals previoustimestamp previous timestamp modified eventstopublish events publish add fileevent file event filedetails file details thisfile file currenttimestamp current timestamp fileoperation file operation updated file notified notifychanged notify changed remove thisfile file getcanonicalpath canonical path ioexception exception locate deleted files priorfiles prior files keyset key set removeall remove currentexecution current execution keyset key set entry file entry priorfiles prior files entryset entry set file deletedfile deleted file entry getkey key eventstopublish events publish add fileevent file event filedetails file details deletedfile deleted file entry getvalue fileoperation file operation deleted file notified notifydeleted notify deleted remove deletedfile deleted file getcanonicalpath canonical path ioexception exception data previous execution newly monitored location entry file entry currentexecution current execution entryset entry set eventstopublish events publish add fileevent file event filedetails file details entry getkey key entry getvalue fileoperation file operation monitoring start record monitored location location contents ready execution priorexecution prior execution request currentexecution current execution discard created deleted notifications correctly discovered loop notifycreated notify created clear notifydeleted notify deleted clear explicitly handle undiscovered update notifications identical millisecond update occurred canonicalpath canonical path notifychanged notify changed file file file canonicalpath canonical path eventstopublish events publish add fileevent file event filedetails file details file file lastmodified modified fileoperation file operation updated notifychanged notify changed clear publish eventstopublish events publish eventstopublish events publish size scannotified scan notified lock norequestsorchanges requests publishrequestedfileevents publish requested file events updatechanges update filecanonicalpath file canonical path remove requestingclass requesting changemap change map keyset key set remove changemap change map requestingclass requesting remove filecanonicalpath file canonical path changemap change map requestingclass requesting add filecanonicalpath file canonical path remove allfiles files remove filecanonicalpath file canonical path allfiles files add filecanonicalpath file canonical path